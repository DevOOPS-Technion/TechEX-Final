<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TechEX - Parcel Tracking System{% endblock %}</title>
    
    <!-- Vite-compiled Tailwind CSS with DaisyUI -->
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" type="text/css" />
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Logo font, navigation enhancements, and glass card fixes -->
    <style>
        .logo-text {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        /* Enhanced logo styles for navbar */
        .logo-container {
            height: 32px;
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .logo-image {
            height: 32px;
            width: auto;
            max-width: 120px;
            transition: all 0.3s ease;
            object-fit: contain;
        }
        
        .logo-image:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
        }
        
        [data-theme="dark"] .logo-image:hover {
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
        }
        
        /* Theme-aware logo visibility */
        [data-theme="light"] .theme-dark {
            display: none !important;
        }
        
        [data-theme="light"] .theme-light {
            display: block !important;
        }
        
        [data-theme="dark"] .theme-light {
            display: none !important;
        }
        
        [data-theme="dark"] .theme-dark {
            display: block !important;
        }
        
        /* Active navigation button enhancements */
        .nav-btn.btn-active {
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2) inset, 0 0 20px hsl(var(--p) / 0.5);
            text-shadow: 0 0 8px hsl(var(--p));
            color: hsl(var(--p));
        }
        
        [data-theme="dark"] .nav-btn.btn-active {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.05) inset, 0 0 25px hsl(var(--p) / 0.7);
            text-shadow: 0 0 10px hsl(var(--p));
        }
        
        /* Responsive logo adjustments */
        @media (max-width: 768px) {
            .logo-container {
                height: 28px;
            }
            
            .logo-image {
                height: 28px;
                max-width: 100px;
            }
        }
        
        /* Glass card styling fixes for light mode visibility */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 0 20px rgba(255, 255, 255, 0.1) inset;
        }
        
        [data-theme="dark"] .glass-card {
            background: rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.05) inset;
        }
        

    </style>
</head>
<body class="min-h-screen bg-base-100 page-transition">
    <!-- Modern Pill Navigation -->
    <div class="fixed top-0 left-0 right-0 z-50">
        <nav class="navbar-pill">
            <div class="flex items-center justify-between w-full">
                <!-- Logo (visible on all pages) -->
                <div class="flex items-center mr-2">
                    <a href="{{ url_for('index') }}" class="flex items-center space-x-3 text-xl font-bold logo-text text-primary hover:text-primary-focus transition-colors">
                        <!-- Theme-aware logo images -->
                        <div class="logo-container">
                            <img src="{{ url_for('static', filename='TechEX_light.png') }}" 
                                 alt="TechEX Logo" 
                                 class="logo-image theme-light">
                            <img src="{{ url_for('static', filename='TechEX_dark.png') }}" 
                                 alt="TechEX Logo" 
                                 class="logo-image theme-dark hidden">
                        </div>
                    </a>
                </div>

                <!-- Navigation -->
                <div class="flex items-center space-x-3">
                    <a href="{{ url_for('index') }}" class="btn btn-ghost btn-sm rounded-full nav-btn {% if request.endpoint == 'index' %}btn-active{% endif %}">
                        <i class="fas fa-home mr-1"></i>
                        <span class="hidden sm:inline">Home</span>
                    </a>
                    <a href="{{ url_for('list_parcels') }}" class="btn btn-ghost btn-sm rounded-full nav-btn {% if request.endpoint in ['list_parcels', 'edit_parcel'] %}btn-active{% endif %}">
                        <i class="fas fa-boxes mr-1"></i>
                        <span class="hidden sm:inline">Parcels</span>
                    </a>
                    <a href="{{ url_for('add_parcel') }}" class="btn btn-ghost btn-sm rounded-full nav-btn {% if request.endpoint == 'add_parcel' %}btn-active{% endif %}">
                        <i class="fas fa-plus mr-1"></i>
                        <span class="hidden sm:inline">Add</span>
                    </a>
                    <a href="{{ url_for('statistics') }}" class="btn btn-ghost btn-sm rounded-full nav-btn {% if request.endpoint == 'statistics' %}btn-active{% endif %}">
                        <i class="fas fa-chart-line mr-1"></i>
                        <span class="hidden sm:inline">Stats</span>
                    </a>
                </div>

                <!-- Right side with theme toggle -->
                <div class="flex items-center pl-2">
                    <!-- Theme toggle -->
                    <label class="swap swap-rotate nav-btn btn btn-ghost btn-sm rounded-full ml-4">
                        <input type="checkbox" value="light" class="theme-controller" />
                        <svg class="swap-on fill-current w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
                        </svg>
                        <svg class="swap-off fill-current w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
                        </svg>
                    </label>
                </div>
            </div>
        </nav>
    </div>

    <!-- Spacer for fixed navbar -->
    <div class="h-20"></div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container mx-auto px-4 pt-4">
                {% for category, message in messages %}
                    <div role="alert" class="alert {% if category == 'error' %}alert-error{% elif category == 'success' %}alert-success{% else %}alert-info{% endif %} animate-fade-in mb-4">
                        {% if category == 'error' %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        {% elif category == 'success' %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        {% endif %}
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content with smooth transitions -->
    <main id="page-root" class="container mx-auto px-4 py-6 max-w-7xl content-wrapper">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer footer-center p-4 bg-base-300 text-base-content mt-auto">
        <div>
            <p>
                <i class="fas fa-copyright mr-1"></i>
                2025 TechEX v{{ version or '2.0' }} - Parcel Tracking System
                <i class="fas fa-heart text-red-500 mx-2"></i>
                Built with Flask & DaisyUI
            </p>
            <p class="text-xs opacity-60 mt-1">
                <i class="fas fa-server mr-1"></i>
                Served by: <span class="badge badge-sm badge-primary">{{ node_name or 'local' }}</span>
            </p>
        </div>
    </footer>

    <!-- JavaScript for theme switching and other interactions -->
    <script>
        // Theme switching functionality for DaisyUI 5
        const themeController = document.querySelector('.theme-controller');
        const htmlElement = document.documentElement;
        
        // Load saved theme or default to dark
        const savedTheme = localStorage.getItem('theme') || 'dark';
        htmlElement.setAttribute('data-theme', savedTheme);
        
        // Set initial toggle state
        if (themeController) {
            themeController.checked = savedTheme === 'light';
        }
        
        // Theme toggle event listener
        if (themeController) {
            themeController.addEventListener('change', function() {
                const newTheme = this.checked ? 'light' : 'dark';
                htmlElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Dispatch custom event for theme change
                window.dispatchEvent(new CustomEvent('themechange', { detail: { theme: newTheme } }));
            });
        }

        // Smooth animations for page load
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.animate-fade-in');
            elements.forEach((el, index) => {
                el.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        alert.remove();
                    }, 300);
                }, 5000);
            });
        });

        // Confirmation dialogs for delete actions
        function confirmDelete(message = 'Are you sure you want to delete this item?') {
            return confirm(message);
        }

        // Form validation enhancement
        function validateForm(form) {
            const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('input-error');
                    isValid = false;
                } else {
                    input.classList.remove('input-error');
                }
            });
            
            return isValid;
        }

        // Add loading state to buttons on form submission
        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn && validateForm(form)) {
                        submitBtn.classList.add('loading');
                        submitBtn.disabled = true;
                    } else if (!validateForm(form)) {
                        e.preventDefault();
                    }
                });
            });
        });

        // Lightweight SPA-like navigation to avoid full refreshes
        document.addEventListener('DOMContentLoaded', function() {
            const root = document.getElementById('page-root');
            if (!root) return;

            function shouldIntercept(link) {
                const href = link.getAttribute('href');
                return href && href.startsWith('/') && !href.startsWith('//') && !link.hasAttribute('data-no-spa');
            }

            // Function to update navigation active states
            function updateNavigation(url) {
                // Remove active class from all navigation buttons
                const navButtons = document.querySelectorAll('.nav-btn');
                navButtons.forEach(btn => {
                    btn.classList.remove('btn-active');
                });
                
                // Determine which button should be active based on URL
                let activeButton = null;
                if (url === '/' || url === '') {
                    activeButton = document.querySelector('a[href="/"]');
                } else if (url.startsWith('/edit_parcel/')) {
                    // Edit parcel pages should highlight the parcels button
                    activeButton = document.querySelector('a[href="/parcels"]');
                } else if (url === '/parcels') {
                    activeButton = document.querySelector('a[href="/parcels"]');
                } else if (url === '/add_parcel') {
                    activeButton = document.querySelector('a[href="/add_parcel"]');
                } else if (url === '/statistics') {
                    activeButton = document.querySelector('a[href="/statistics"]');
                }
                
                // Add active class to the correct button
                if (activeButton) {
                    activeButton.classList.add('btn-active');
                }
            }

            async function navigate(url, push = true) {
                try {
                    document.body.classList.add('loading');
                    const res = await fetch(url, { headers: { 'X-Requested-With': 'fetch' } });
                    const html = await res.text();
                    const doc = new DOMParser().parseFromString(html, 'text/html');
                    const newContent = doc.querySelector('#page-root');
                    const newTitle = doc.querySelector('title');
                    if (newContent) {
                        root.innerHTML = newContent.innerHTML;
                        if (newTitle) document.title = newTitle.textContent;
                        if (push) history.pushState({}, '', url);
                        
                        // Update navigation active states
                        updateNavigation(url);
                        
                        // Re-run basic init for fade-in elements
                        const elements = root.querySelectorAll('.animate-fade-in');
                        elements.forEach((el, idx) => { el.style.animationDelay = `${idx * 0.1}s`; });
                        document.body.classList.remove('loading');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        window.location.href = url; // fallback
                    }
                } catch (e) {
                    window.location.href = url; // fallback on error
                }
            }

            document.addEventListener('click', function(e) {
                const link = e.target.closest('a');
                if (!link) return;
                if (!shouldIntercept(link)) return;
                e.preventDefault();
                const href = link.getAttribute('href');
                if (href && href !== window.location.pathname) {
                    navigate(href, true);
                }
            });

            window.addEventListener('popstate', function() {
                navigate(window.location.pathname, false);
            });
            
            // Initialize navigation on page load
            updateNavigation(window.location.pathname);
        });

        // Global function for navigating to edit pages (used by tracking number clicks)
        window.navigateToEdit = function(parcelId) {
            const url = `/edit_parcel/${parcelId}`;
            
            // Create a temporary link and trigger the SPA navigation
            const tempLink = document.createElement('a');
            tempLink.href = url;
            tempLink.style.display = 'none';
            document.body.appendChild(tempLink);
            
            // Trigger a click event to use the existing SPA navigation
            tempLink.click();
            
            // Clean up
            document.body.removeChild(tempLink);
        };
    </script>
</body>
</html>
